# TreapMap メソッド説明

---

## 🔰 1. 初期化・基本情報

### `new(op, e)`
- **説明**  
  空のImplicitTreapを作成します。  
  `op` は値を結合する関数、`e` は単位元です。

### `size()`
- **説明**  
  ノード数を返します。

---

## ✏️ 2. データの挿入・削除・更新

### `insert(key, val)`
- **説明**  
  指定キーに値`val`を挿入します。  
  内部で乱数優先度に基づくバランス調整を行います。
- **コーナーケース**
  - 同じキーがあっても重複挿入されます。
  - 挿入位置がサイズを超えても動作します。

### `erase(key)`
- **説明**  
  指定キーに一致する全てのノードを削除します。
- **コーナーケース**
  - キーがなければ何もしません。
  - 複数キーがあれば全て削除されます。

### `update(key, val)`
- **説明**  
  指定キーのノードを全て削除し、新しく挿入します。
- **コーナーケース**
  - キーが存在しなければ新規挿入になります。
  - 複数キーは削除されて1つだけになります。

---

## 🔍 3. 要素の取得

### `get(key)`
- **説明**  
  指定キーに一致する最初の値を返します。
- **コーナーケース**
  - キーがなければ`None`。
  - 複数同キーの場合は探索で最初に見つかった1つのみ。
  - 重複キーの完全取得はできません。

### `kth(k)`
- **説明**  
  順序で`k`番目(0-based)の値を返します。
- **コーナーケース**
  - `k`がサイズ以上なら`None`。
  - 複数同キーでも順序に従って1つ返す。
  - 空ツリーなら`None`。

---

## 🧮 4. 集約（モノイド演算）

### `prod(l, r)`
- **説明**  
  半開区間 `[l, r)` の値を`op`で結合した結果を返します。
- **コーナーケース**
  - `l >= r` の場合は単位元`e`を返します。
  - 範囲外や空区間も安全に処理します。

### `all_prod()`
- **説明**  
  全ノードの値を`op`で結合した結果を返します。  
  ツリー空なら単位元`e`。

---

## 🔧 5. 構造操作

### `split(key)`
- **説明**  
  キーを基準にツリーを2つに分割。  
  左は `< key`、右は `>= key` のノード集合。  
  元ツリーは空になります。
- **コーナーケース**
  - `key`が最小未満なら左は空、右が全体。
  - `key`が最大超なら右は空、左が全体。

### `merge(other)`
- **説明**  
  自身のツリーと`other`ツリーをマージし新ツリーを返す。  
  両方の元ツリーは空になります。
- **コーナーケース**
  - 重複キーがあってもそのままマージ。
  - どちらかが空なら空でない方が返る。

---

## 🧪 6. デバッグ用

### `debug()`
- **説明**  
  中間順で `(key, val)` のリストを表示します。  
  デバッグ用。


